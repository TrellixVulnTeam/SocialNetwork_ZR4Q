{% extends 'base_apps.html' %}
{% load crispy_forms_tags %}
{% load static %}


{% block title %}Home{% endblock title %}
{% block content %}

<!--    <section class="features">
		<h1>Dashboard</h1>
		<div class="container">
			<div class="row">


				<div class="col-md-4">
					<div class="feature-box">

						<div class="feature-details" >
							<h4>Posts</h4>
								<p >You've already made <h2 >13</h2> posts
								</p>
								<div>
									<span><a type="button" onclick="make()">Start a new post</a></span>
									<span><a href="">Manage my posts</a></span>

									</div>
						</div>
					</div>
				</div>
				<div class="col-md-4">
					<div class="feature-box">

						<div class="feature-details">
							<h4>Network</h4>
								<p>You're connected with <h2>94</h2> geeks</p>
								<div>
									<span><a href="">Grow my network</a></span>
									<span><a href="">Manage my network</a></span>
									</div>
						</div>
					</div>
				</div>
				<div class="col-md-4">
					<div class="feature-box">

						<div class="feature-details" >
							<h4>Domains</h4>
								<p>You're registered to <h2>41</h2> branches</p>
								<div>
									<span><a href="">Grow my domain</a></span>
									<span><a href="{% url 'Alldomains' %}">Manage my domain</a></span>
									</div>
						</div>
					</div>
				</div>
			</div>
		</div>

    </section>-->
	<section class="body">
		<div class="row">
			<div class="modal fade" id="allposts" tabindex="-1" style="margin-left:350px;border-radius:15px;width:auto;" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<form action="{% url 'post_create' %}" method="POST" enctype="multipart/form-data">
					{% csrf_token %}
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel" style="font-weight:bold;">Create a post</h5>
					<a type="button" class="close" data-dismiss="modal" aria-label="Close" href="{% url 'home_page' %}">
						<span aria-hidden="true">&times;</span>
					</a>
				</div>
				<div class="modal-body">
						<!--POSTS-->

						<div class="col2">
							<div class="input-group">
							<a class="user-profile" href=""><img class="images" src="{{ profile.profile_photo.url }}"></a>
							<p>{{user.first_name}} {{user.last_name}}</p>
							</div>
						</div>
						<div class="col-sm-10" style="font-size: small;">

							<div>
								{{ form|crispy }}

								</div>
						</div>



				</div>
				<div class="modal-footer">
						
						<button type="submit" class="btn btn-primary"  style="padding: 3px;">Post</button>
				</div>
			</form>
			</div>

		</div>
	</div>


			<!--	<div class="col-md-4">
					<div class="body-box" style="width:auto;margin-left:20px;position: fixed;">

						<div class="body-details">
							<h4>Sub menus</h4>
								<div class="menus">
									<div class="sub-menus">
																			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-laptop" viewBox="0 0 16 16">
  <path d="M13.5 3a.5.5 0 0 1 .5.5V11H2V3.5a.5.5 0 0 1 .5-.5h11zm-11-1A1.5 1.5 0 0 0 1 3.5V12h14V3.5A1.5 1.5 0 0 0 13.5 2h-11zM0 12.5h16a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 12.5z"/>
</svg>
										<a href="" >  Programming </a></div>
									<div class="sub-menus">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-server" viewBox="0 0 16 16">
  <path d="M1.333 2.667C1.333 1.194 4.318 0 8 0s6.667 1.194 6.667 2.667V4c0 1.473-2.985 2.667-6.667 2.667S1.333 5.473 1.333 4V2.667z"/>
  <path d="M1.333 6.334v3C1.333 10.805 4.318 12 8 12s6.667-1.194 6.667-2.667V6.334c-.43.32-.931.58-1.458.79C11.81 7.684 9.967 8 8 8c-1.967 0-3.81-.317-5.21-.876a6.508 6.508 0 0 1-1.457-.79z"/>
  <path d="M14.667 11.668c-.43.319-.931.578-1.458.789-1.4.56-3.242.876-5.209.876-1.967 0-3.81-.316-5.21-.876a6.51 6.51 0 0 1-1.457-.79v1.666C1.333 14.806 4.318 16 8 16s6.667-1.194 6.667-2.667v-1.665z"/>
</svg>
										<a href="" > Data science</a></div>
									<div class="sub-menus">

<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cpu" viewBox="0 0 16 16">
  <path d="M5 0a.5.5 0 0 1 .5.5V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2A2.5 2.5 0 0 1 14 4.5h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14a2.5 2.5 0 0 1-2.5 2.5v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14A2.5 2.5 0 0 1 2 11.5H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2A2.5 2.5 0 0 1 4.5 2V.5A.5.5 0 0 1 5 0zm-.5 3A1.5 1.5 0 0 0 3 4.5v7A1.5 1.5 0 0 0 4.5 13h7a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 11.5 3h-7zM5 6.5A1.5 1.5 0 0 1 6.5 5h3A1.5 1.5 0 0 1 11 6.5v3A1.5 1.5 0 0 1 9.5 11h-3A1.5 1.5 0 0 1 5 9.5v-3zM6.5 6a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"/>
</svg>
										<a  href="" > Artificial Intelligence </a></div>
								</div>
						</div>
					</div>
				</div>-->



					<div class="row">
						<div class="col3" style="width:600px;margin-left:120px;">
							<div class="col2">
					<div class="posts">
					<div class="body-box">
						<div class="body-details" >
						<div class="input-group">
							
							<a class="user-profile" href="{% url 'profile' %}" ><img src="{{ profile.profile_photo.url  }}"></a>
							<button type="button" onclick="make()" class="form-control" style="font-weight:bold;background-color: #efefef;border-radius:20px;">Start your post here...</button>
					</div>

						</div>

							</div>
						 <hr>
						</div>
									</div>
						</div>



			<div class="these_posts">
				{% for thisPost in home_posts %}

				<div class="posts">
					<div class="body-box">
						<div class="body-details" >
						{% if user.is_authenticated %}
						

									<div class="row">
									<div class="col3">

										<div class="col2">
									<a href="" ><img class="rounded-circle article-img" src="{{ thisPost.author.profile_photo.url }}" alt="" ></a>
											</div>
										</div>
									<div class="col3">

										<div class="col2_id">
									<p>{{ thisPost.author}}</p>

										</div>

										<div class="col2_date">
											<p>{{ thisPost.createdTime }} <br>
												{{ thisPost.createdTime|timesince}} ago <br>
												<small style="font-size: 12px;">{{ thisPost.domain}}</small>
												
											</p>
									
											
										</div>
										
										</div>
										
										<div class="col3" style="margin-left:auto;margin-right: 10px;">
											<div class="col2">

												<div class="dropdown">

													<a class="button btn-outline-primary" onclick="myFunction2()" href="#" style="margin-left:20px;">
														<svg  xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots" viewBox="0 0 16 16">
  															<path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/>
														</svg>

													</a>
													<div class="dropdown-content dropdown-menu-right" id="myDropdown2">

														<a href="{% url 'post_detail' pk=thisPost.id %}" style="font-size:14px;">View post</a>
														<hr>
														<a href="#" style="font-size:14px;">Save post</a>
														<hr>
														
															<a href="{% url 'post_update' pk=thisPost.id %}"  style="font-size:14px;">Edit post</a>
																<hr>
															<a href="#" style="font-size:14px;">Delete post</a>
													  
													</div>
					  							</div>

											</div>

										</div>
										</div>
									<div class="description">
										<hr>
									<p style="width: auto;">{{ thisPost.description }}</p>
									{% if thisPost.image_attached %}
									<a href="http://127.0.0.1:8000{{ thisPost.image_attached.url }}">
										<img class="attachedImage" src="{{ thisPost.image_attached.url }}" alt="">
										</a>
									{% endif %}
									
										</div>
										
													<div class="text-right" style="font-size:12px;margin-top:10px;margin-right:50px;font-weight:bold;">
														<a href="" class="like-count{{thisPost.id}}"> {{ thisPost.num_likes }}  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hand-thumbs-up" viewBox="0 0 16 16">
												<path d="M8.864.046C7.908-.193 7.02.53 6.956 1.466c-.072 1.051-.23 2.016-.428 2.59-.125.36-.479 1.013-1.04 1.639-.557.623-1.282 1.178-2.131 1.41C2.685 7.288 2 7.87 2 8.72v4.001c0 .845.682 1.464 1.448 1.545 1.07.114 1.564.415 2.068.723l.048.03c.272.165.578.348.97.484.397.136.861.217 1.466.217h3.5c.937 0 1.599-.477 1.934-1.064a1.86 1.86 0 0 0 .254-.912c0-.152-.023-.312-.077-.464.201-.263.38-.578.488-.901.11-.33.172-.762.004-1.149.069-.13.12-.269.159-.403.077-.27.113-.568.113-.857 0-.288-.036-.585-.113-.856a2.144 2.144 0 0 0-.138-.362 1.9 1.9 0 0 0 .234-1.734c-.206-.592-.682-1.1-1.2-1.272-.847-.282-1.803-.276-2.516-.211a9.84 9.84 0 0 0-.443.05 9.365 9.365 0 0 0-.062-4.509A1.38 1.38 0 0 0 9.125.111L8.864.046zM11.5 14.721H8c-.51 0-.863-.069-1.14-.164-.281-.097-.506-.228-.776-.393l-.04-.024c-.555-.339-1.198-.731-2.49-.868-.333-.036-.554-.29-.554-.55V8.72c0-.254.226-.543.62-.65 1.095-.3 1.977-.996 2.614-1.708.635-.71 1.064-1.475 1.238-1.978.243-.7.407-1.768.482-2.85.025-.362.36-.594.667-.518l.262.066c.16.04.258.143.288.255a8.34 8.34 0 0 1-.145 4.725.5.5 0 0 0 .595.644l.003-.001.014-.003.058-.014a8.908 8.908 0 0 1 1.036-.157c.663-.06 1.457-.054 2.11.164.175.058.45.3.57.65.107.308.087.67-.266 1.022l-.353.353.353.354c.043.043.105.141.154.315.048.167.075.37.075.581 0 .212-.027.414-.075.582-.05.174-.111.272-.154.315l-.353.353.353.354c.047.047.109.177.005.488a2.224 2.224 0 0 1-.505.805l-.353.353.353.354c.006.005.041.05.041.17a.866.866 0 0 1-.121.416c-.165.288-.503.56-1.066.56z"/>
												</svg></a>
														||<a href="" class="comment-count">	{{ thisPost.num_comments }}	<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-dots" viewBox="0 0 16 16">
												<path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
												<path d="M2.165 15.803l.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437 0 0 1-.524 2.318l-.003.011a10.722 10.722 0 0 1-.244.637c-.079.186.074.394.273.362a21.673 21.673 0 0 0 .693-.125zm.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97 0 0 0 .398-2z"/>
												</svg></a>
														||<a href="">	{{ thisPost.num_shares }} <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-share" viewBox="0 0 16 16">
												<path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5zm-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"/>
												</svg></a>
												</div>
																			<hr>
									<div class="row" style="margin-bottom:5px;">
										<div class="col3">
											<div class="col2">
												<form action="{% url 'Likes' %}" method="POST" class="like-form" id="{{thisPost.id}}">
													{% csrf_token %}
												<input type="hidden" name="post_id" value={{thisPost.id}}>
											<a href="#">
												<button class="btn btn-outline-primary like-btn {{thisPost.id}}" type="submit" >

												<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hand-thumbs-up" viewBox="0 0 16 16">
		  											<path d="M8.864.046C7.908-.193 7.02.53 6.956 1.466c-.072 1.051-.23 2.016-.428 2.59-.125.36-.479 1.013-1.04 1.639-.557.623-1.282 1.178-2.131 1.41C2.685 7.288 2 7.87 2 8.72v4.001c0 .845.682 1.464 1.448 1.545 1.07.114 1.564.415 2.068.723l.048.03c.272.165.578.348.97.484.397.136.861.217 1.466.217h3.5c.937 0 1.599-.477 1.934-1.064a1.86 1.86 0 0 0 .254-.912c0-.152-.023-.312-.077-.464.201-.263.38-.578.488-.901.11-.33.172-.762.004-1.149.069-.13.12-.269.159-.403.077-.27.113-.568.113-.857 0-.288-.036-.585-.113-.856a2.144 2.144 0 0 0-.138-.362 1.9 1.9 0 0 0 .234-1.734c-.206-.592-.682-1.1-1.2-1.272-.847-.282-1.803-.276-2.516-.211a9.84 9.84 0 0 0-.443.05 9.365 9.365 0 0 0-.062-4.509A1.38 1.38 0 0 0 9.125.111L8.864.046zM11.5 14.721H8c-.51 0-.863-.069-1.14-.164-.281-.097-.506-.228-.776-.393l-.04-.024c-.555-.339-1.198-.731-2.49-.868-.333-.036-.554-.29-.554-.55V8.72c0-.254.226-.543.62-.65 1.095-.3 1.977-.996 2.614-1.708.635-.71 1.064-1.475 1.238-1.978.243-.7.407-1.768.482-2.85.025-.362.36-.594.667-.518l.262.066c.16.04.258.143.288.255a8.34 8.34 0 0 1-.145 4.725.5.5 0 0 0 .595.644l.003-.001.014-.003.058-.014a8.908 8.908 0 0 1 1.036-.157c.663-.06 1.457-.054 2.11.164.175.058.45.3.57.65.107.308.087.67-.266 1.022l-.353.353.353.354c.043.043.105.141.154.315.048.167.075.37.075.581 0 .212-.027.414-.075.582-.05.174-.111.272-.154.315l-.353.353.353.354c.047.047.109.177.005.488a2.224 2.224 0 0 1-.505.805l-.353.353.353.354c.006.005.041.05.041.17a.866.866 0 0 1-.121.416c-.165.288-.503.56-1.066.56z"/>
												</svg>

											{% if user not in thisPost.likes.all %}
												Like
											{% else %}
												Unlike
											{% endif %}
											</button>
										</a>
												</form>
												</div>
											</div>
									<div class="col3">
											<div class="col2">
										<a href="#">
										<button class="btn btn-outline-primary cmt_btn" onclick="comments()">
											<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-dots" viewBox="0 0 16 16">
												<path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
												<path d="M2.165 15.803l.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437 0 0 1-.524 2.318l-.003.011a10.722 10.722 0 0 1-.244.637c-.079.186.074.394.273.362a21.673 21.673 0 0 0 .693-.125zm.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97 0 0 0 .398-2z"/>
											  </svg>
									  
									  
																		  Comment
										</button>
										</a>
									
												</div>
											</div>

										<div class="col3">
											<div class="col2">
												<a href="">
									<button class="btn btn-outline-primary share" >

																			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-share" viewBox="0 0 16 16">
											<path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5zm-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"/>
											</svg>
										Share
									</button>
								</a>
													</div>
								</div>
								</div>
								<br>
								<div class="extra content" style="display: none;" >
									
								<div class="comment-box" >
									<hr>
									<p class="text-center" style="font-weight:bold;">All comments</p> 
									{% if thisPost.comment_set.all %}
									{% for c in thisPost.comment_set.all %}
									
										<div  style="font-size: 12px; background-color: #efefef;">
											<img class="ui avatar image" src="{{ c.user.profile_photo.url }}" style="height: 50px;width: 50px; border-radius: 100%;">
											<span style="font-weight: bold;">{{ c.user }}</span><br>
											<span >{{ c.created }}</span>
											<p class="text-center" style="font-size: 14px;">{{ c.body }}</p>
											
										</div>
									
									{% endfor %}
									{% endif %}
									
								</div>
								<form action="{% url 'home_comment' %}" method="POST" >
									{% csrf_token %}
									<input type="hidden" name="post_id" value={{thisPost.id}}>
									<br>
									<div class="commentButton">
										{{ c_form }}
									<button type="submit" name="submit_c_form" class="btn btn-outline-primary">Post</button>
								</div>
								</form>
							</div>
									
								
							
					

					
						{% else %}
 							 <a class="btn btn-outline-info" href="{% url 'login_page' %}">Log in to like this article!</a><br>
						{% endif %}
					</div>
					</div>
				</div>
				{% endfor %}

				</div>

						<div class="col3">
							<div class="col2">
				<div class="col-md-4">
					<div class="body-box" id="about">

						<div class="body-details"  style="width: 250px; margin-left:20px;  position: fixed; height: 60%;">
							<h4>Abouts</h4>
								<p>Specialized in web development,<br> web design, mobile apps
									
									Come enjoy programming!!!</p>
							<hr>
						<div class="container text-center">
							<p><i class="fa fa-copyright" ></i> 2021<a href="mailto: enockhamuli@gmail.com"> Enock Hamuli </a>. All right reserved.</p><br>
						</div>
						</div>

					</div>
				</div>
									</div>
						</div>


				</div>


			</div>


		</section>

{% endblock content %}


{% block scripts %} 

<script >
	
	/*function displayComment()
	{
    	$('#myComments').show('slow');
	};
	*/
	$( document ).ready(function() {

		let display = false
        $(".cmt_btn").click(function () {
            if (display===false) {
                $(this).next(".extra").show("slow");
                display=true
            } else {
                $(this).next(".extra").hide("slow");
                display=false
            }  
        });

		

		$('.like-form').submit(function(e){
			e.preventDefault()
			
			const post_id = $(this).attr('id')
			
			const likeText = $(`.like-btn${post_id}`).text()
			const trim = $.trim(likeText)

			const url = $(this).attr('action')
			
			let res;
			const likes = $(`.like-count${post_id}`).text()
			const trimCount = parseInt(likes)
			
			$.ajax({
				type: 'POST',
				url: url,
				data: {
					'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
					'post_id':post_id,
				},
				success: function(response) {
					if(trim === 'Unlike') {
						$(`.like-btn${post_id}`).text('Like')
						res = trimCount - 1
					} else {
						$(`.like-btn${post_id}`).text('Unlike')
						res = trimCount + 1
					}

					$(`.like-count${post_id}`).text(res)
				},
				error: function(response) {
					console.log('error', response)
				}
			})

		})
	});
</script>
{% endblock scripts %}